# Workspace monitor for Sway
# Outputs workspace buttons in eww format

# Initial workspace state
workspaces() {
  local buttons
  buttons=$(swaymsg -t get_workspaces | jq -c '[.[] | {
    num: .num,
    name: .name,
    focused: .focused,
    visible: .visible,
    urgent: .urgent
  }]' | jq -r '.[] |
    "(button :class \"workspace-button" +
    (if .focused then " focused" elif .visible then " visible" elif .urgent then " urgent" else "" end) +
    "\" :onclick \"swaymsg workspace number " + (.num | tostring) + "\" \"" + .name + "\")"' | tr '\n' ' ')
  echo "(box :class \"workspaces\" :spacing 5 ${buttons})"
}

# Print initial workspaces
workspaces

# Listen for workspace changes
swaymsg -t subscribe -m '["workspace"]' | while read -r _; do
  workspaces
done
